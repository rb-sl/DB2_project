<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="style.css">
	<title>Create a new questionnaire</title>
</head>
<body>
<h1>Create a new questionnaire</h1>

<form action="CreateQuestionnaire" method="POST">
	Questionnaire date: <input type="date" name="date" th:value="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}"><br>
	Product name: <input type="text" id="product" name="product" oninput="ACProducts()">
	<input type="radio" id="newProduct" name="radioProduct" value="-1" checked>New product <br>

	<div id="prodSugg" style="display: none">
		Similar previous products
		<table>
			<tbody id="previousProducts">
			</tbody>
		</table>
	</div>

	Product image: <input type="file" name="image" accept="image/*"><br>
</form>

<script th:inline="javascript">
	/*<![CDATA[*/
	var products = [[${miniProducts}]];
	/*]]>*/

    var prodMap = Object.entries(products).map(([id, name]) => ({id, name}));

	function ACProducts() {
	    var text = document.getElementById("product").value;
	    var table = document.getElementById("previousProducts");

	    table.innerHTML = "";

	    var hasResults = false;

		if(text !== "") {
            prodMap.forEach(function (prod) {
                if (prod.name.toLowerCase().indexOf(text) >= 0) {
                    table.innerHTML += "<tr><td><input type='radio' name='radioProduct' value='" + prod.id + "'/></td><td>" + prod.name + "</td></tr>";
                    hasResults = true;
                }
            })
        }

		if(hasResults) {
            document.getElementById("prodSugg").style.display = "block";
		}
		else {
            document.getElementById("prodSugg").style.display = "none";
		}

		document.getElementById("newProduct").checked = true;
	}
</script>

</body>
</html>